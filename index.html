<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Bull vs Bear</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@farcade/game-sdk@latest/dist/index.min.js"></script>
  <style>
    body {
      margin: 0;
      padding-top: env(safe-area-inset-top);
      overflow: hidden;
      user-select: none;
      background-color: #000;
    }
    #game-container {
      width: 100vw;
      height: calc(100vh - env(safe-area-inset-top));
    }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <script>
    // Telegram init
    window.Telegram = window.Telegram || {};
    Telegram.WebApp = Telegram.WebApp || {};
    const tg = Telegram.WebApp;
    tg.ready = tg.ready || function(){};
    tg.MainButton = tg.MainButton || {};
    tg.MainButton.setText = tg.MainButton.setText || function(){};
    tg.MainButton.show = tg.MainButton.show || function(){};
    tg.MainButton.hide = tg.MainButton.hide || function(){};
    tg.MainButton.onClick = tg.MainButton.onClick || function(){};
    tg.ready();

    class GameScene extends Phaser.Scene {
      constructor() {
        super('GameScene');
      }

      preload() {
        this.load.image('bull', 'https://.../bull.png');
        this.load.image('bear', 'https://.../bear.png');
        this.load.image('hit', 'https://.../hit.png');
        this.load.image('bg', 'https://.../background.png');
      }

      create() {
        this.add.image(180, 320, 'bg').setDisplaySize(360, 640);

        this.score = 0;
        this.bear = this.add.sprite(260, 420, 'bear').setScale(0.25);
        this.bull = this.add.sprite(100, 420, 'bull').setScale(0.25);

        this.scoreText = this.add.text(180, 40, 'Score: 0', { fontSize: '24px', fill: '#fff' }).setOrigin(0.5);
        this.input.on('pointerdown', this.handleTap, this);

        // Telegram кнопка
        tg.MainButton.setText("Играть снова");
        tg.MainButton.onClick(() => {
          tg.MainButton.hide();
          this.scene.restart();
        });

        // Farcade ready
        window.FarcadeSDK.singlePlayer.actions.ready();
      }

      handleTap() {
        if (this.ended) return;
        this.score++;
        this.scoreText.setText('Score: ' + this.score);
        this.tweens.timeline({
          targets: this.bull,
          tweens: [{ x: this.bear.x - 20, duration: 100 }, { x: 100, duration: 100 }]
        });
        const hit = this.add.image(this.bear.x, this.bear.y, 'hit').setScale(0.2);
        this.tweens.add({ targets: hit, alpha: 0, duration: 200, onComplete: () => hit.destroy() });

        if (this.score >= 20) {
          this.endGame();
        }
      }

      endGame() {
        this.ended = true;
        this.bull.setAlpha(0.5);
        this.bear.setAlpha(0.5);

        this.time.delayedCall(1000, () => {
          window.FarcadeSDK.singlePlayer.actions.gameOver({ score: this.score });
        });

        if (tg.MainButton) {
          tg.MainButton.show();
        }
      }
    }

    new Phaser.Game({
      type: Phaser.AUTO,
      width: 360,
      height: 640,
      parent: 'game-container',
      scene: [GameScene],
      scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
      }
    });
  </script>
</body>
</html>
